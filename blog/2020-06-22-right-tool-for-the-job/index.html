<!DOCTYPE html>
<html lang="en"><meta charset="utf-8">
<title>The Right Tool for the Job | nevstokes.com</title>

<link rel="preload" as="font" href="/fonts/quicksand-300-latin-ext.woff2" type="font/woff2" crossorigin="anonymous">

<link rel="canonical" href="https://nevstokes.com/blog/2020-06-22-right-tool-for-the-job/" />



<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/syntax.css">

<meta name="description" content="Personal site">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<a href="#content">Skip to main content</a>

    <main><header>
    <a href="/">nevstokes.com</a>
    <nav>
        
            <a title="Blog" href="/blog/">Blog</a>
        
            <a title="About Me" href="/page/about-me/">About Me</a>
        
            <a title="Accessibility" href="/page/accessibility/">Accessibility</a>
        
            <a title="Colophon" href="/page/colophon/">Colophon</a>
        
    </nav>
</header>


    <article id="content">
        <h1>The Right Tool for the Job</h1>

        
            <div class="meta">
    <p><svg aria-label="Posted on"><use xlink:href="/symbol-defs.svg#icon-calendar"></use></svg> Wednesday, July 1, 2020</p>

    <p><svg aria-label="Reading time"><use xlink:href="/symbol-defs.svg#icon-watch"></use></svg> 3 minutes</p>
</div>

        

        <figure>
    <blockquote>If my only tool is a hammer, then every problem is a nail.</blockquote>
    <figcaption>
        &mdash; Sholem Asch
    </figcaption>
</figure>

<p>For example, try not to use loops if possible &ndash; pipe things through xargs, where you can often get the benefit of parallelism</p>
<p>No
for VALUE in <code>&lt;command&gt;</code>; do <stuff>; done</p>
<p>Yes
<command> | xargs <stuff></p>
<p>Can&rsquo;t always use xargs (built-ins)?</p>
<p>&ndash;no-run-if-empty</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span>
which axel

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    apt install axel
<span class="k">fi</span></code></pre></td></tr></table>
</div>
</div>
<p><code>which</code> is a actually remnent from <code>csh</code> &ndash; it&rsquo;ll still work but it can misbehave. When you&rsquo;re using <code>bash</code> or want to be POSIX-compliant, use <code>command -v</code> and logical boolean operators instead of a conditional:</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">echo</span> -n <span class="s2">&#34;Checking for axel... &#34;</span> <span class="se">\
</span><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">command</span> -v axel <span class="o">||</span> <span class="o">(</span><span class="nb">echo</span> <span class="s2">&#34;installing&#34;</span> <span class="o">&amp;&amp;</span> apt install axel<span class="o">)</span></code></pre></div>
<p>When is bash not bash? When it&rsquo;s dash. Make sure you&rsquo;re explicit in your shell</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"> <span class="c1">#!/bin/env bash</span>

<span class="k">for</span> i in <span class="sb">`</span>df / /usr /boot /var /var/log --output<span class="o">=</span>avail -m <span class="p">|</span> grep -v Avail<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> <span class="se">\
</span><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="nv">$i</span> -lt <span class="m">250</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span><span class="se"></span>        &gt;<span class="p">&amp;</span><span class="m">2</span> <span class="nb">echo</span> ERROR: server running out of space <span class="o">&amp;&amp;</span> <span class="nb">exit</span> 1<span class="p">;</span>
    <span class="k">fi</span><span class="p">;</span>
<span class="k">done</span></code></pre></td></tr></table>
</div>
</div>
<p>Leaving the backtick syntax aside for the moment&hellip;</p>
<p>grep for Avail &ndash; just happens to be the first line. No inbuilt option to not display this. Use the right tool for the job; in this case, sed 1d.</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">df / /usr /boot /var /var/log --output<span class="o">=</span>file,avail -m <span class="se">\
</span><span class="se"></span>    <span class="p">|</span> sed 1d <span class="se">\
</span><span class="se"></span>    <span class="p">|</span> awk -v <span class="nv">limit</span><span class="o">=</span><span class="m">250</span> <span class="se">\
</span><span class="se"></span>        <span class="s1">&#39;{
</span><span class="s1">            if (int($2) &lt; limit) {
</span><span class="s1">                print &#34;ERROR:&#34;, $1, &#34;running out of space&#34; &gt; &#34;/dev/stderr&#34;;
</span><span class="s1">                exit 1;
</span><span class="s1">            }
</span><span class="s1">        }&#39;</span></code></pre></td></tr></table>
</div>
</div>
<p>awk and sed work really well for text processing but in this case we can actually use awk directly:</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">df / /usr /boot /var /var/log --output<span class="o">=</span>file,avail -m <span class="se">\
</span><span class="se"></span>    <span class="p">|</span> awk -v <span class="nv">limit</span><span class="o">=</span><span class="m">250</span> <span class="se">\
</span><span class="se"></span>    <span class="s1">&#39;NR &gt; 1 {
</span><span class="s1">        if (int($2) &lt; limit) {
</span><span class="s1">            print &#34;ERROR:&#34;, $1, &#34;running out of space&#34; &gt; &#34;/dev/stderr&#34;;
</span><span class="s1">            exit 1;
</span><span class="s1">        }
</span><span class="s1">    }&#39;</span></code></pre></td></tr></table>
</div>
</div>
<p>head &amp; tail</p>
<p>Take the first / last rows of a file. Skip the first n lines.</p>
<p>grep</p>
<p>Search files for a pattern. (Cover -Po etc)</p>
<p>cut &amp; awk</p>
<p>Split rows of a file</p>
<p>Can often render a seperate grep operation unessecary.</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">awk <span class="s1">&#39;/Test/ { print $1 }&#39;</span></code></pre></td></tr></table>
</div>
</div>
<p>tr &amp; sed</p>
<p>Character replacement</p>
<p>sort, uniq &amp; comm</p>
<p><code>comm</code> is a cleaner diff.</p>
<p>jq</p>
<p>Unlike the others, not a core utility always required, in <code>aws ssm get-params</code> for example.</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span>
<span class="k">while</span> <span class="nb">read</span> key value<span class="p">;</span> <span class="k">do</span>
    <span class="nb">export</span> <span class="k">$(</span><span class="nb">printf</span> <span class="s2">&#34;%s=%s&#34;</span> <span class="k">$(</span>basename <span class="si">${</span><span class="nv">key</span><span class="p">^^</span><span class="si">}</span><span class="k">)</span> <span class="si">${</span><span class="nv">value</span><span class="si">}</span><span class="k">)</span>
<span class="k">done</span> &lt; &lt;<span class="o">(</span>aws ssm get-parameters-by-path <span class="se">\
</span><span class="se"></span>    --path /path/to/values <span class="se">\
</span><span class="se"></span>    --query <span class="s2">&#34;Parameters[*].{Name:Name,Value:Value}&#34;</span> <span class="se">\
</span><span class="se"></span>    --output<span class="o">=</span>text<span class="o">)</span></code></pre></td></tr></table>
</div>
</div>
<p>There&rsquo;s a bit to unpack here. Using Parameter expansion, process and command substitutions.</p>





<div tabindex="0" aria-label="Code sample" aria-role="presentation" class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span>
<span class="k">while</span> <span class="nb">read</span> key value<span class="p">;</span> <span class="k">do</span>
    <span class="nb">export</span> <span class="k">$(</span><span class="nb">printf</span> <span class="s2">&#34;%s=%s&#34;</span> <span class="k">$(</span><mark>basename</mark> <mark><span class="si">${</span><span class="nv">key</span><span class="p">^^</span><span class="si">}</span></mark><span class="k">)</span> <span class="si">${</span><span class="nv">value</span><span class="si">}</span><span class="k">)</span>
<span class="k">done</span> &lt; &lt;<span class="o">(</span>aws ssm get-parameters <span class="se">\
</span><span class="se"></span>    --names <mark>/list/of/<span class="o">{</span>parameters,values<span class="o">}</span></mark> <span class="se">\
</span><span class="se"></span>    --query <span class="s2">&#34;Parameters[*].{Name:Name,Value:Value}&#34;</span> <span class="se">\
</span><span class="se"></span>    --output<span class="o">=</span>text<span class="o">)</span></code></pre></td></tr></table>
</div>
</div>
<ol>
<li><code>basename</code> will strip the leading path information, leaving only the variable name.</li>
<li>This is <code>bash</code> parameter expansion which converts the variable to uppercase.</li>
<li>Shorthand notation for multiple values, similar to <code>bash</code> brace expansion.</li>
</ol>
<h2 id="substitutions">Substitutions</h2>
<p>In short, these are powerful tools, highly optimised for specific use cases.</p>
<p>You may have seen me referencing this article before.</p>
<p>It&rsquo;s well worth spending some time to really get to know the command line. <a href="https://www.shellcheck.net/">https://www.shellcheck.net/</a>
<a href="https://explainshell.com/">https://explainshell.com/</a></p>

    </article>

    
    <nav>
    
        <a href="https://nevstokes.com/blog/2020-06-15-confessions-of-a-bashist/" title="Confessions of a Bashist">&laquo; Previous Post</a>
    
    
        <a href="https://nevstokes.com/blog/2020-06-28-out-with-the-old/" title="Out With the Old">Next Post &raquo;</a>
    
    </nav>
    
<footer>
    <ul class="container" aria-label="Social Links">
        <li>
            <a href="https://twitter.com/nevstokes" title="Twitter" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-twitter"></use></svg>
                <span>My Twitter Feed</span>
            </a>
        </li>
        <li>
            <a href="https://keybase.io/nevstokes" title="Keybase" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-keybase"></use></svg>
                <span>My Keybase Identity</span>
            </a>
        </li>
        <li>
            <a href="https://github.com/nevstokes" title="GitHub" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-github"></use></svg>
                <span>My GitHub Repositories</span>
            </a>
        </li>
        <li>
            <a href="https://linkedin.com/in/nevstokes" title="LinkedIn" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-linkedin"></use></svg>
                <span>My LinkedIn Profile</span>
            </a>
        </li>
        <li>
            <a href="https://stackoverflow.com/users/224639/nev-stokes" title="StackOverflow" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-stackoverflow"></use></svg>
                <span>My StackOverflow Activity</span>
            </a>
        </li>
        <li>
            <a href="https://www.strava.com/athletes/nevstokes" title="Strava" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-strava"></use></svg>
                <span>My Strava Activities</span>
            </a>
        </li>
        <li>
            <a href="https://nevstokes.com/index.xml" title="RSS" target="_blank" rel="noopener noreferrer">
                <svg><use xlink:href="/symbol-defs.svg#icon-rss"></use></svg>
                <span>This Blog's RSS Feed</span>
            </a>
        </li>
    </ul>
</footer>
</main>
</html>
