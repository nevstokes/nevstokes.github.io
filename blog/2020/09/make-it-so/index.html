<!doctype html><html lang=en><meta charset=utf-8><title>Make It So | nevstokes.com</title><link rel=preload as=font href=/fonts/quicksand-300-latin.woff2 type=font/woff2 crossorigin=anonymous><link rel=icon href=/favicon.svg><link rel=canonical href=https://nevstokes.com/blog/2020/09/make-it-so/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax.css><meta name=description content="Personal site"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,user-scalable=yes,viewport-fit=cover"><a href=#content>Skip to main content</a><main><header><a href=/>nevstokes.com</a><nav><a title=Blog href=/blog/>Blog</a>
<a title="About Me" href=/page/about-me/>About Me</a>
<a title=Accessibility href=/page/accessibility/>Accessibility</a>
<a title=Colophon href=/page/colophon/>Colophon</a></nav></header><article id=content><h1>Make It So</h1><div class=meta><p><svg aria-label="Posted on"><use xlink:href="/symbol-defs.svg#icon-calendar"/></svg>Thursday, September 17, 2020</p><p><svg aria-label="Reading time"><use xlink:href="/symbol-defs.svg#icon-watch"/></svg>4 minutes</p></div><figure><blockquote>Something is wrong if workers do not look around each day, find things that are tedious or boring, and then rewrite the procedures.</blockquote><figcaption>&mdash; Taiichi Ohno</figcaption></figure><p>In recent years there&rsquo;s been something of a resurgence in using a <code>Makefile</code> for project orchestration. If you&rsquo;re not familiar, <code>Make</code> is used to define targets which will perform assigned actions. Its intended purpose is to create assets although it is also possible to treat it as a task runner along the lines of <code>gulp</code> or <code>grunt</code>.</p><p><code>Make</code> is well-established, widely available and <a href=https://www.gnu.org/prep/standards/html_node/Utilities-in-Makefiles.html#Utilities-in-Makefiles>largely portable</a>. It provides an efficient, self-documenting single point of entry which negates multiple scripts littering the repository. With a bit of forethought, you can craft some semantic sugar that gives an immediate contextual hint as what each target will do in easy-to-understand natural language.</p><p>Orchestrating in this way means that as well as being runnable on a developer&rsquo;s local machine, there&rsquo;s no vendor lock-in to any CI or ties to third-party plugins. It doesn&rsquo;t matter if the project is using Jenkins, GitHub Actions or Travis, we can defer control to <code>Make</code>.</p><p>Another way to leverage these targets is with <code>git</code> hooks to implement some preventative and corrective actions during local development and get faster feedback loops or on the server-side of the version control system to facilitate <a href=https://www.gitops.tech/>GitOps</a> deployments.</p><p>In addition to IDE-level tooling, using the fastest tools earliest in the git hook lifecycle provides useful feedback in a timely manner.</p><p>I&rsquo;ve outlined some examples of potential targets and use-cases below:</p><h2 id=client-side-hooks>Client-side hooks</h2><details open><summary><code>pre-commit</code></summary><dl><dt><code>make nice</code></dt><dd>Quick linting and code style enforcement.</dd><dt><code>make safe</code></dt><dd>Scan for security anti-patterns and secrets -- like passwords, tokens or API keys -- that may have been accidentally added to the codebase.</dd></dl></details><details open><summary><code>commit-msg</code></summary><dl><dt><code>make commit</code></dt><dd>Check that the commit message meets any mandated requirements.</dd></dl></details><details open><summary><code>pre-push</code></summary><dl><dt><code>make checks</code></dt><dd>Run auditing or compliance tasks such as checking for accessibility issues, licence violations, and outdated or vulnerable dependencies.</dd></dl></details><h2 id=server-side-hooks>Server-side hooks</h2><details open><summary><code>pre-receive</code></summary><dl><dt><code>make sure</code></dt><dd>Developers are free to disable their local hooks. Run those same commands to double check and fail early should anything not be right.</dd></dl></details><details open><summary><code>post-receive</code></summary><dl><dt><code>make tests</code></dt><dd>Run functional tests: unit, contract, mocked integration, regression, and mutation as applicable.</dd><dt><code>make decision</code></dt><dd>Quality gates. Get a go / no go to proceed further.</dd><dt><code>make build</code></dt><dd>Create an OCI container image or generate a static website archive.</dd><dt><code>make infrastructure</code></dt><dd>Provision resources as defined by declarative infrastructure as code.</dd><dt><code>make deployment</code></dt><dd>Once all the preceeding steps have been completed, the artifacts can be pushed with confidence. Run transactional end-to-end tests along with non-functional tests such as for security and performance.</dd><dt><code>make release</code></dt><dd>Just as an automated blue / green deployment gives an opportunity to gradually deploy and rollback if any errors are detected, a seperate progressive release strategy provides a safety net should anything go awry at the final step.</dd><dt><code>make documentation</code></dt><dd>Generate and publish API specifications.</dd><dt><code>make comms</code></dt><dd>Circulate release notes or make an announcement on a messaging platform.</dd></dl></details><p>Note that there is no direct implication of the underlying technologies used with these abstractions; it&rsquo;s completely language-independent and tooling-agnostic. The responsibility for implementing the work lies with the projects using this framework.</p><p>That said, quite a bit can be inferred from file-based conventions &ndash; not necessarily directly tied to our new project templates. Taking inspiration from Heroku&rsquo;s concept of Buildpacks &ndash; which were designed to handle deployments at scale &ndash; it&rsquo;s possible to construct a matrix of trigger files and corresponding tools.</p><p>This defines a set of predefined tasks which can be run in parallel at each stage in the process, where any one of them could stop the pipeline should it find an issue.</p><div tabindex=0 aria-role=region aria-label="Pipeline stage tooling matrix"><table><thead><tr><th></th><th><code>nice</code></th><th><code>safe</code></th><th><code>checks</code></th><th><code>tests</code></th></tr></thead><tbody><tr><td><code>package.json</code></td><td><code>prettier</code></td><td><code>eslint-plugin-security</code></td><td><code>resolve-audit</code></td><td><code>stryker</code></td></tr><tr><td><code>requirements.txt</code></td><td><code>flake8</code></td><td><code>bandit</code></td><td><code>safety</code></td><td><code>mutmut</code></td></tr><tr><td><code>Dockerfile</code></td><td><code>hadolint</code></td><td><code>semgrep</code></td><td><code>snyk</code></td><td><code>inspec</code></td></tr><tr><td><code>cdk.json</code></td><td><code>eslint</code></td><td><code>cfn_nag</code></td><td><code>opa</code></td><td><code>jest</code></td></tr></tbody></table></div><p>This is just by way of some minimal examples. In reality there could be layers or combinations of tools applied at each stage. A more fine-grained control of what to do &ndash; and when &ndash; can be achieved by adding targets to appropriate lists based on the presence of individual configuration files, such as:</p><ul><li><code>.eslintrc.js</code></li><li><code>.prettierrc</code></li><li><code>cypress.json</code></li><li><code>jest.config.js</code></li></ul><p>The point is that the developers now don&rsquo;t have to think about a lot of this stuff; it&rsquo;s taken care of for them and they can focus on what they want to do &ndash; namely writing quality code. Paving the roads and providing secure defaults for the quickest, smoothest paths to production.</p><p>Alignment on a small selection of languages gives continuity and allows planning for recruitment and maintenance. Doing this too for frameworks and libraries as well as approach and tooling &ndash; with caveats of freedom of OS and IDE &ndash; can guarantee consistency and adherence to best-practice.</p><p><svg aria-label="Posted in"><use xlink:href="/symbol-defs.svg#icon-tag"/></svg>#<a href=https://nevstokes.com/tags/dev/>dev</a>&nbsp;
#<a href=https://nevstokes.com/tags/make/>make</a>&nbsp;
#<a href=https://nevstokes.com/tags/work/>work</a>&nbsp;</p></article><nav><a href=https://nevstokes.com/blog/2020/09/asking-too-much/ title="Asking Too Much">&#171; Previous Post</a>
<a href=https://nevstokes.com/blog/2020/09/taxing-affairs/ title="Taxing Affairs">Next Post &#187;</a></nav><footer><ul class=container aria-label="Social Links"><li><a href=https://twitter.com/nevstokes title=Twitter target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-twitter"/></svg><span>My Twitter Feed</span></a></li><li><a href=https://keybase.io/nevstokes title=Keybase target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-keybase"/></svg><span>My Keybase Identity</span></a></li><li><a href=https://github.com/nevstokes title=GitHub target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-github"/></svg><span>My GitHub Repositories</span></a></li><li><a href=https://linkedin.com/in/nevstokes title=LinkedIn target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-linkedin"/></svg><span>My LinkedIn Profile</span></a></li><li><a href=https://stackoverflow.com/users/224639/nev-stokes title=StackOverflow target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-stackoverflow"/></svg><span>My StackOverflow Activity</span></a></li><li><a href=https://www.strava.com/athletes/nevstokes title=Strava target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-strava"/></svg><span>My Strava Activities</span></a></li><li><a href=https://nevstokes.com/index.xml title=RSS target=_blank rel="noopener noreferrer"><svg><use xlink:href="/symbol-defs.svg#icon-rss"/></svg><span>This Blog's RSS Feed</span></a></li></ul></footer></main></html>